# Neta Architecture

This document provides a high-level overview of the Neta application's architecture.

## System Overview

Neta acts as a bridge between WhatsApp Web and various AI chat platforms (like ChatGPT, Claude, Gemini, etc.). It monitors designated WhatsApp chats for new messages or images, sends them to the corresponding AI service via its web interface, and returns the response to the originating WhatsApp chat.

+---------------------+      +---------------------+      +----------------------+
|                     |      |                     |      |                      |
|  WhatsApp Web UI    |----->|     Neta Service    |----->|  AI Platform Web UIs |
| (Monitored via      |      |  (Python Process)   |      |  (Automated via      |
|  Browser Automation)|<-----|                     |<-----|  Browser Automation) |
+---------------------+      +---------------------+      +----------------------+

## Core Layers

The application operates across three main functional layers:

1.  **WhatsApp Layer:** This layer interacts directly with the WhatsApp Web interface running in a controlled browser instance. Its primary responsibilities are selecting the configured chats and detecting new incoming messages (both text and images).
2.  **Neta Service Layer (Core Logic):** This is the central orchestrator written in Python. It manages the overall workflow, loads configurations (like which chat maps to which AI), routes incoming WhatsApp messages to the correct AI platform layer, prevents duplicate message processing using a simple cache, and routes the AI responses back to the WhatsApp layer.
3.  **AI Platform Layer:** Similar to the WhatsApp layer, this interacts with the web interfaces of the various configured AI platforms (ChatGPT, Claude, Gemini, etc.) within the browser. It handles sending prompts or uploading images and extracting the generated responses from the AI's chat interface.

## Interaction Method & Automation

* **Browser Automation:** Neta fundamentally relies on **UI automation** using **Selenium**. It launches and controls a visible Google Chrome browser instance to interact with the live web interfaces of both WhatsApp Web and the AI platforms. This means you need to be logged into these services in the browser Neta controls.
* **Goal: Background Operation:** Currently, the browser window is visible during operation. A key area for future improvement is optimizing Neta to run reliably in the background (e.g., using headless browser mode), making it less intrusive.
* **"Auto-Guessing" UI Elements:** Instead of requiring strict, predefined CSS selectors for every input field and button on each AI platform's ever-changing UI, Neta incorporates a degree of "auto-guessing". It attempts common strategies to find text input areas and image upload mechanisms automatically. Surprisingly, this heuristic approach has proven reasonably effective, reducing the need for constant configuration updates.

## Development Approach & Code Status

It's important to note the development style reflects the project's origins (as mentioned in the main README):

* **Rapid Development:** Much of the code was developed quickly ("vibe coded").
* **Minimal Review:** The code hasn't undergone extensive peer review.
* **Pragmatic Implementation:** Development often involves copying and adapting existing code patterns within the project, with direct intervention focused primarily on fixing issues or adding core functionality as needed.

## Data Flow Summary

1.  **Detection:** The Neta service monitors the WhatsApp Web UI via the controlled browser for new messages in configured chats.
2.  **Routing & Processing:** New messages are passed to the Neta service, which determines the target AI based on the chat name. Text or images are sent to the appropriate AI platform's web UI.
3.  **Response Retrieval:** Neta waits for and extracts the response generated by the AI within its web interface.
4.  **Delivery:** The extracted response is sent back to the original WhatsApp chat via the WhatsApp Web UI automation.
